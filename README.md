# ğŸ”¥å®ç°é¡¹ç›®001-2023åŸºäºSSMæ¡†æ¶å¼€å‘çš„ä¸ªäººåšå®¢é¡¹ç›®

## ä¸€ã€é¡¹ç›®ä»‹ç»

### 1ã€é¡¹ç›®ç®€ä»‹

æœ¬é¡¹ç›®ä¸ºä¸ªäººåšå®¢é¡¹ç›®ï¼Œæ—¨åœ¨å¯¹SSMçš„ç»¼åˆåº”ç”¨ï¼Œæé«˜å¤§å®¶å¯¹è¿™ä¸‰ä¸ªæ¡†æ¶çš„çš„åŸºæœ¬ä½¿ç”¨èƒ½åŠ›ï¼Œé¡¹ç›®åˆ†ä¸ºå‰å°å’Œåå°ï¼Œåšå®¢åŸºæœ¬çš„åŠŸèƒ½é½å…¨ï¼Œå¸Œæœ›å¤§å®¶èƒ½å¤Ÿè®¤çœŸçš„æŠŠè¯¥é¡¹ç›®å®Œæˆã€‚

### 2ã€æŠ€æœ¯æ¶æ„

- Spring
- SpringMVC
- Mybatis (é€šç”¨Mapper)
- Mysql
- Jqueryã€Ajaxã€Hutool
- Maven
- jsp
- BootStrapã€Editormdã€Layerjs
- layui
- font-awesome

Spring + SpringMVC + Mybatis + Mysql + Jquery + Maven + jsp + BootStrap + layui + Editormd + Echarts + font-awesome

### 3ã€å¼€å‘ç¯å¢ƒ

- Tomcat 9
- Mysql 8
- IDEA2020 +

### 4ã€åŠŸèƒ½æ¨¡å—

####  4.1 åå°

##### ç”¨æˆ·æ¨¡å—

ç”¨æˆ·ç™»å½•(å¤šç”¨æˆ·) ã€ç”¨æˆ·ä¸ªäººä¿¡æ¯ä¿®æ”¹(å¼‚æ­¥ä¸Šä¼ å¤´åƒ)ã€ç™»å½•ä¿¡æ¯å†å²ã€é€€å‡ºç³»ç»Ÿã€ç”¨æˆ·å¢åˆ æ”¹æŸ¥

##### æ–‡ç« æ¨¡å—

æ–‡ç« æ·»åŠ ï¼ˆé‡‡ç”¨ editormd åœ¨çº¿å®æ—¶ç¼–è¾‘ï¼‰ï¼Œæ–‡ç« åˆ—è¡¨æ¡ä»¶åˆ†é¡µæŸ¥è¯¢ã€æ–‡ç« ä¿®æ”¹ï¼ˆæ–‡ç« æ˜¯å¦å…¬å¼€ä¿®æ”¹ã€æ–‡ç« ç½®é¡¶ï¼‰ã€æ–‡ç« åˆ é™¤

##### å…¬å‘Šæ¨¡å—

å¢åˆ æ”¹æŸ¥

##### è¯„è®ºæ¨¡å—

å¢åˆ æ”¹æŸ¥ 

##### ç•™è¨€æ¨¡å—

å¢åˆ æ”¹æŸ¥ 

##### æ ç›®ç®¡ç†æ¨¡å—

æ ç›®çˆ¶çº§å’Œå­çº§æ·»åŠ ã€ä¿®æ”¹å’Œåˆ é™¤ 

##### ç³»ç»Ÿè®¾ç½®

ç³»ç»ŸåŸºæœ¬ç«™ç‚¹æ ‡é¢˜ã€åŸŸåå’Œå¤‡æ¡ˆè®¾ç½®

##### æ—¥å¿—æ¨¡å—

slf4j + aopå®Œæˆæ—¥å¿—åˆ‡é¢ç®¡ç†

#### **4.2 å‰å°**

##### ç”¨æˆ·æ¨¡å—

ç”¨æˆ·ç™»å½•ã€ç”¨æˆ·æ³¨å†Œ

##### æ–‡ç« æ¨¡å—

æ–‡ç« åˆ—è¡¨å±•ç¤ºã€æ–‡ç« æœç´¢ã€ç½®é¡¶æ–‡ç« æ¨èã€çƒ­é—¨æ–‡ç« æ¨èã€ æœ€è¿‘è®¿å®¢ã€æ–‡ç« è¯¦æƒ…é¡µ(å†…åµŒeditormd)ã€‚

##### è¯„è®ºæ¨¡å—

å‘è¡¨æ–‡ç« è¯„è®ºã€ä¸€çº§è¯„è®ºå’ŒäºŒçº§è¯„è®ºå±•ç¤º

##### ç•™è¨€æ¨¡å—

ç»™åšä¸»ç•™è¨€

##### å‹é“¾ç®¡ç†

åšå®¢å‹æƒ…é“¾æ¥

##### ç«™ç‚¹å…¬å‘Š

ç«™ç‚¹å…¬å‘Šå±•ç¤º



## äºŒã€ç¯å¢ƒæ­å»º

### 1ã€æ•°æ®åº“è¡¨è®¾è®¡

#### 1.1 ç”¨æˆ·è¡¨

| **åˆ—å**      | **æ•°æ®ç±»å‹** | **é•¿åº¦** | **æ˜¯å¦ä¸»é”®** | **æ³¨é‡Š**                       |
| ------------- | ------------ | -------- | ------------ | ------------------------------ |
| uid           | int          | 11       | ä¸»é”®         | ä¸»é”®                           |
| username      | varchar      | 32       |              | ç”¨æˆ·å                         |
| nickname      | varchar      | 32       |              | æ˜µç§°                           |
| password      | varchar      | 32       |              | å¯†ç MD5åŠ å¯†                    |
| role          | char         | 1        |              | 0:ç®¡ç†å‘˜ 1:æ™®é€šç”¨æˆ·            |
| createTime    | char         | 10       |              | åˆ›å»ºæ—¶é—´                       |
| lastLoginTime | char         | 19       |              | ç™»å½•æ—¶é—´                       |
| state         | char         | 1        |              | è´¦å·æ˜¯å¦è¢«é”å®š 0:é”å®š 1:æœªé”å®š |
| loginIp       | varchar      | 17       |              | ç™»å½•ip                         |
| phone         | char         | 11       |              | æ‰‹æœºå·ç                        |
| loginCout     | int          | 11       |              | ç™»å½•æ¬¡æ•°                       |
| img           | varchar      | 255      |              | ç”¨æˆ·å¤´åƒ                       |

#### 1.2 æ–‡ç« è¡¨

| **åˆ—å**    | **æ•°æ®ç±»å‹** | **é•¿åº¦** | **æ˜¯å¦ä¸»é”®** | **æ³¨é‡Š**                   |
| ----------- | ------------ | -------- | ------------ | -------------------------- |
| aid         | int          | 11       | ä¸»é”®         | ä¸»é”®                       |
| title       | varchar      | 255      |              | æ–‡ç« æ ‡é¢˜                   |
| digest      | varchar      | 255      |              | æ‘˜è¦                       |
| content     | longtext     | 255      |              | æ–‡ç« å†…å®¹                   |
| cid         | int          | 11       |              | æ‰€å±æ ‡ç­¾åˆ†ç±»               |
| visit_count | int          | 10       |              | è®¿é—®é‡                     |
| create_time | char         | 19       |              | å‘å¸ƒæ—¶é—´                   |
| update_time | char         | 19       |              | æ›´æ–°æ—¶é—´                   |
| is_hot      | int          | 1        |              | æ˜¯å¦çƒ­é—¨ 0ï¼šä¸çƒ­é—¨ 1ï¼šçƒ­é—¨ |
| logo        | varchar      | 255      |              | æ–‡ç« logo                   |
| uid         | int          | 11       |              | å‘å¸ƒè€…                     |
| isOpen      | char         | 1        |              | æ˜¯å¦å…¬å¼€ 0:ä¸å…¬å¼€ 1:å…¬å¼€   |
| thumbsUp    | bigint       | 10       |              | ç‚¹èµæ•°                     |
| tagNames    | varchar      | 255      |              | æ–‡ç« æ ‡ç­¾                   |
| isCommented | char         | 1        |              | æ˜¯å¦è¢«è¯„è®º                 |

####  1.3 æ ç›®è¡¨

| **åˆ—å** | **æ•°æ®ç±»å‹** | **é•¿åº¦** | **æ˜¯å¦ä¸»é”®** | **æ³¨é‡Š** |
| -------- | ------------ | -------- | ------------ | -------- |
| cid      | int          | 11       | ä¸»é”®         | ä¸»é”®     |
| cname    | varchar      | 255      |              | æ ç›®åç§° |

#### 1.4 é“¾æ¥è¡¨

| **åˆ—å**  | **æ•°æ®ç±»å‹** | **é•¿åº¦** | **æ˜¯å¦ä¸»é”®** | **æ³¨é‡Š**             |
| --------- | ------------ | -------- | ------------ | -------------------- |
| id        | int          | 11       | ä¸»é”®         | ä¸»é”®                 |
| site_name | varchar      | 255      |              | ç«™ç‚¹å               |
| site_url  | varchar      | 255      |              | ç«™ç‚¹åœ°å€             |
| site_desc | varchar      | 255      |              | ç«™ç‚¹æè¿°  ç®€å•å¤‡æ³¨ä¸‹ |
| sort      | int          | 1        |              | æ’åº                 |

#### 1.5 æ ‡ç­¾è¡¨

| **åˆ—å** | **æ•°æ®ç±»å‹** | **é•¿åº¦** | **æ˜¯å¦ä¸»é”®** | **æ³¨é‡Š** |
| -------- | ------------ | -------- | ------------ | -------- |
| tid      | int          | 11       | ä¸»é”®         | ä¸»é”®     |
| tname    | varchar      | 32       |              | æ ‡ç­¾åç§° |
| cid      | varchar      | 11       |              | æ‰€å±æ ç›® |

### 2ã€æ–°å»ºMavenå·¥ç¨‹

![å›¾ç‰‡1](/images/buildpro101/å›¾ç‰‡1.png)

![å›¾ç‰‡2](/images/buildpro101/å›¾ç‰‡2.png)

åˆ›å»ºMavenå·¥ç¨‹å®Œæ¯•åï¼Œè®¾ç½®å¥½MavenåŸºæœ¬ç›®å½•ï¼Œå¹¶æŒ‡å®šæºç å’Œé…ç½®æ–‡ä»¶è·¯å¾„

![å›¾ç‰‡3](/images/buildpro101/å›¾ç‰‡3.png)

åˆ›å»ºé¡¹ç›®çš„åŸºæœ¬å·¥ç¨‹åŒ…ç»“æ„ï¼Œå¦‚ä¸‹

![å›¾ç‰‡4](/images/buildpro101/å›¾ç‰‡4.png)

### 3ã€é…ç½®æ–‡ä»¶

#### 3.1 Spring

applicationContext.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:p="http://www.springframework.org/schema/p"
	   xmlns:aop="http://www.springframework.org/schema/aop" xmlns:context="http://www.springframework.org/schema/context"
	   xmlns:tx="http://www.springframework.org/schema/tx"
	   xsi:schemaLocation="http://www.springframework.org/schema/beans
	 http://www.springframework.org/schema/beans/spring-beans.xsd
	http://www.springframework.org/schema/aop
	http://www.springframework.org/schema/aop/spring-aop.xsd
	http://www.springframework.org/schema/context
	http://www.springframework.org/schema/context/spring-context.xsd
	http://www.springframework.org/schema/tx
	 http://www.springframework.org/schema/tx/spring-tx.xsd">

	<!--
		æ‰¹é‡æ‰«æåŒ…
		è®©SpringIOCå®¹å™¨ç®¡ç†å¯¹è±¡
		ç¼–å†™å®ä½“ç±»çš„æ—¶å€™åˆ«å¿˜è®°ç»™å®ä½“ç±»åŠ ä¸Š@Component
	-->
	<context:component-scan
			base-package="com.bjpowernode.blog" />

	<!--å¼•å…¥spring-service.xml-->
	<import resource="classpath:spring/spring-service.xml" />

</beans>
```

spring-dao.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:p="http://www.springframework.org/schema/p"
	   xmlns:aop="http://www.springframework.org/schema/aop" xmlns:context="http://www.springframework.org/schema/context"
	   xmlns:tx="http://www.springframework.org/schema/tx"
	   xsi:schemaLocation="http://www.springframework.org/schema/beans
	 http://www.springframework.org/schema/beans/spring-beans.xsd
	http://www.springframework.org/schema/aop
	http://www.springframework.org/schema/aop/spring-aop.xsd
	http://www.springframework.org/schema/context
	http://www.springframework.org/schema/context/spring-context.xsd
	http://www.springframework.org/schema/tx
	 http://www.springframework.org/schema/tx/spring-tx.xsd">

	<!--å¼•å…¥jdbc.properties,è·å–é“¾æ¥æ•°æ®åº“çš„åŸºæœ¬ä¿¡æ¯-->
	<context:property-placeholder location="classpath:mybatis/jdbc.properties" />


	<!--åˆ›å»ºæ•°æ®åº“è¿æ¥æ± :dbcpè¿æ¥æ± -->
	<bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource">
		<property name="driverClassName" value="${jdbc.driverClass}" />
		<property name="url" value="${jdbc.jdbcUrl}" />
		<property name="username" value="${jdbc.username}" />
		<property name="password" value="${jdbc.password}" />
	</bean>

	<!--
		ç”ŸæˆSqlSessionFactory
		éœ€è¦é…ç½®åŸå…ˆSqlMapConfig.xmlä¸­çš„åŠŸèƒ½
	-->
	<bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean">
			<!--å¼•å…¥æ•°æ®æº-->
			<property name="dataSource" ref="dataSource" />
			<!--ç»™åŒ…æŒ‡å®šåˆ«å-->
			<property name="typeAliasesPackage" value= "com.bjpowernode.blog.back.bean" />
			<!--å¯¼å…¥æ˜ å°„æ–‡ä»¶-->
		    <property name="mapperLocations" value="classpath:mappers/*Mapper.xml" />
        <!--å¯¼å…¥SqlMapConfig.xml:å°±æ˜¯ä¸ºäº†æ‰“å°sql-->
        <property name="configLocation" value="classpath:mybatis/SqlMapConfig.xml" />

			<!--é…ç½®Mybatisåˆ†é¡µæ’ä»¶:PageHelper-->
			<property name="plugins">
				<array>
					<bean class="com.github.pagehelper.PageHelper">
						<property name="properties">
							<props>
								<!--dialect:æ•°æ®åº“æ–¹è¨€-->
								<prop key="dialect">mysql</prop>
								<prop key="supportMethodsArguments">true</prop>
							</props>
						</property>
					</bean>
				</array>
			</property>
	</bean>

	<bean class="tk.mybatis.spring.mapper.MapperScannerConfigurer">
		<!--æŸ¥æ‰¾SqlsessionFactory-->
		<property name="sqlSessionFactoryBeanName" value="sqlSessionFactory"/>
		<!--æ‰«æmapperæ¥å£åŒ…-->
		<property name="basePackage"
                  value="com.bjpowernode.blog.back.mapper,
com.bjpowernode.blog.fore.mapper" />
	</bean>

</beans>
```

spring-service.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:p="http://www.springframework.org/schema/p"
	   xmlns:aop="http://www.springframework.org/schema/aop" xmlns:context="http://www.springframework.org/schema/context"
	   xmlns:tx="http://www.springframework.org/schema/tx"
	   xsi:schemaLocation="http://www.springframework.org/schema/beans
	 http://www.springframework.org/schema/beans/spring-beans.xsd
	http://www.springframework.org/schema/aop
	http://www.springframework.org/schema/aop/spring-aop.xsd
	http://www.springframework.org/schema/tx
	 http://www.springframework.org/schema/tx/spring-tx.xsd">

	<import resource="classpath:spring/spring-dao.xml" />

	<!--äº‹åŠ¡ç®¡ç†å™¨-->
	<bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
		<!--å¼•å…¥æ•°æ®æº-->
		<property name="dataSource" ref="dataSource" />
	</bean>

	<aop:config>
		<aop:pointcut
				expression="execution(* com.bjpowernode.blog.back.service.*.*(..))"
				id="trPointcut" />
		<aop:advisor pointcut-ref="trPointcut" advice-ref="trAdvice" />
	</aop:config>

	<tx:advice id="trAdvice" transaction-manager="transactionManager">
		<tx:attributes>
			<tx:method name="insert*" propagation="REQUIRED" />
			<tx:method name="delete*" propagation="REQUIRED" />
			<tx:method name="update*" propagation="REQUIRED" />
			<tx:method name="add*" propagation="REQUIRED" />
			<tx:method name="save*" propagation="REQUIRED" />
			<tx:method name="call*" propagation="REQUIRED" />
		</tx:attributes>
	</tx:advice>

</beans>
```

#### 3.2 SpringMVC

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:p="http://www.springframework.org/schema/p"
	   xmlns:context="http://www.springframework.org/schema/context"
	   xmlns:mvc="http://www.springframework.org/schema/mvc"
	   xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
	http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
	http://www.springframework.org/schema/mvc
	http://www.springframework.org/schema/mvc/spring-mvc.xsd">

	<!--æ‰«æControllerç»„ä»¶å¯¹è±¡-->
	<context:component-scan
			base-package="com.bjpowernode.blog.back.controller,
com.bjpowernode.blog.base.controller,com.bjpowernode.blog.fore.controller" />

	<!--å¤„ç†å™¨é€‚é…å™¨å’Œå¤„ç†å™¨æ˜ å°„å™¨-->
	<mvc:annotation-driven>
		<mvc:message-converters register-defaults="true">
			<!--jsonè§£æå™¨-->
			<bean id="mappingJacksonHttpMessageConverter"
				  class="com.alibaba.fastjson.support.spring.FastJsonHttpMessageConverter">
				<!--class="org.springframework.http.converter.json.MappingJacksonHttpMessageConverter">-->
				<property name="supportedMediaTypes">
					<list>
						<value>text/html;charset=UTF-8</value>
						<value>application/json</value>
						<value>application/xml;charset=UTF-8</value>
					</list>
				</property>
			</bean>
		</mvc:message-converters>
	</mvc:annotation-driven>

	<!--å¤„ç†é™æ€èµ„æºæ–‡ä»¶-->
	<mvc:default-servlet-handler />

	<!--è§†å›¾è§£æå™¨-->
	<bean id="viewResolver" class="org.springframework.web.servlet.view.InternalResourceViewResolver">
		<property name="prefix" value="/WEB-INF/article/"/>
		<property name="suffix" value=".jsp"/>
	</bean>

    <!--æ–‡ä»¶ä¸Šä¼ è§£æå™¨-->
    <bean id="multipartResolver" class="org.springframework.web.multipart.commons.CommonsMultipartResolver">
        <property name="defaultEncoding" value="UTF-8"/>
    </bean>

    <!--æ³¨å†Œ:ç™»å½•æ‹¦æˆªå™¨-->
    <mvc:interceptors>
        <mvc:interceptor>
            <!--pathæ‹¦æˆªçš„è·¯å¾„ï¼Œä¸æ˜¯ç›®å½•ï¼Œæ ¹è·¯å¾„æ‹¦æˆªå¤±æ•ˆ[/é¡¹ç›®åä¸éœ€è¦å†™]-->
            <mvc:mapping path="/**"/>
            <mvc:exclude-mapping path="/js/**" />
            <mvc:exclude-mapping path="/article/saveComments" />
            <mvc:exclude-mapping path="/login/**" />
            <mvc:exclude-mapping path="/**" />
            <mvc:exclude-mapping path="/code/**" />
            <mvc:exclude-mapping path="/js/**" />
            <mvc:exclude-mapping path="/bootstrap-3.3.7-dist/**" />
            <mvc:exclude-mapping path="/css/**" />
            <mvc:exclude-mapping path="/font-awesome-4.7.0/**" />
            <mvc:exclude-mapping path="/images/**" />
            <mvc:exclude-mapping path="/kindeditor/**" />
            <mvc:exclude-mapping path="/layui/**" />
            <mvc:exclude-mapping path="/upload/**" />
            <bean class="com.bjpowernode.blog.base.interceptor.LoginInterceptor" />
        </mvc:interceptor>
    </mvc:interceptors>
</beans>
```

#### 3.3 Mybatis

jdbc.properties

```properties
jdbc.username = root
jdbc.password = root
jdbc.jdbcUrl = jdbc\:mysql\:///blog
jdbc.driverClass = com.mysql.jdbc.Driver
```

SqlMapConfig.xml

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE configuration
        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-config.dtd">
<configuration>

    <!--æ‰“å°sql-->
    <settings>
        <!-- æ‰“å°æŸ¥è¯¢è¯­å¥ -->
        <setting name="logImpl" value="STDOUT_LOGGING" />
    </settings>
</configuration>
```

#### 3.4 POMæ–‡ä»¶

```xml
<?xml version="1.0" encoding="UTF-8"?>

<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
  <modelVersion>4.0.0</modelVersion>

  <groupId>com.bjpowernode</groupId>
  <artifactId>blog</artifactId>
  <version>1.0-SNAPSHOT</version>
  <packaging>war</packaging>


    <properties>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
        <maven.compiler.source>1.7</maven.compiler.source>
        <maven.compiler.target>1.7</maven.compiler.target>
    </properties>

    <dependencies>
        <dependency>
            <groupId>junit</groupId>
            <artifactId>junit</artifactId>
            <version>4.11</version>
            <scope>test</scope>
        </dependency>
        <!-- log4j -->
        <dependency>
            <groupId>log4j</groupId>
            <artifactId>log4j</artifactId>
            <version>1.2.17</version>
        </dependency>

        <!--hutool-->
        <dependency>
            <groupId>cn.hutool</groupId>
            <artifactId>hutool-all</artifactId>
            <version>5.5.7</version>
        </dependency>

        <!--Spring-->
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-context</artifactId>
            <version>5.0.3.RELEASE</version>
        </dependency>
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-jdbc</artifactId>
            <version>5.0.3.RELEASE</version>
        </dependency>
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-tx</artifactId>
            <version>5.0.3.RELEASE</version>
        </dependency>
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-web</artifactId>
            <version>5.0.3.RELEASE</version>
        </dependency>
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-webmvc</artifactId>
            <version>5.0.3.RELEASE</version>
        </dependency>
        <dependency>
            <groupId>org.aspectj</groupId>
            <artifactId>aspectjweaver</artifactId>
            <version>1.6.8</version>
        </dependency>

        <!--Mybatis-->
        <dependency>
            <groupId>org.mybatis</groupId>
            <artifactId>mybatis</artifactId>
            <version>3.4.6</version>
        </dependency>
        <!--tkMapper-->
        <dependency>
            <groupId>tk.mybatis</groupId>
            <artifactId>mapper</artifactId>
            <version>4.1.5</version>
        </dependency>
        <!--Mybatiså’ŒSpringæ•´åˆ-->
        <dependency>
            <groupId>org.mybatis</groupId>
            <artifactId>mybatis-spring</artifactId>
            <version>2.0.3</version>
        </dependency>
        <dependency>
            <groupId>mysql</groupId>
            <artifactId>mysql-connector-java</artifactId>
            <version>5.1.36</version>
            <scope>runtime</scope>
        </dependency>

        <!-- æ•°æ®åº“è¿æ¥æ±  -->
        <dependency>
            <groupId>commons-dbcp</groupId>
            <artifactId>commons-dbcp</artifactId>
            <version>1.4</version>
        </dependency>

        <!--å¼•å…¥fastjson-->
        <dependency>
            <groupId>com.alibaba</groupId>
            <artifactId>fastjson</artifactId>
            <version>1.2.3</version>
        </dependency>

        <!--jstl-->
        <dependency>
            <groupId>javax.servlet</groupId>
            <artifactId>jsp-api</artifactId>
            <version>2.0</version>
            <scope>provided</scope>
        </dependency>

        <dependency>
            <groupId>javax.servlet</groupId>
            <artifactId>jstl</artifactId>
            <version>1.2</version>
            <scope>runtime</scope>
        </dependency>
        <dependency>
            <groupId>javax.servlet</groupId>
            <artifactId>javax.servlet-api</artifactId>
            <version>3.1.0</version>
            <scope>provided</scope>
        </dependency>

        <!-- pageHelperï¼šç”¨äºåˆ†é¡µ -->
        <dependency>
            <groupId>com.github.pagehelper</groupId>
            <artifactId>pagehelper</artifactId>
            <version>4.1.6</version>
        </dependency>

        <!--lombok-->
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <version>1.16.12</version>
            <scope>provided</scope>
        </dependency>

        <!--ä¸Šä¼ æ–‡ä»¶-->
        <dependency>
            <groupId>commons-fileupload</groupId>
            <artifactId>commons-fileupload</artifactId>
            <version>1.3.1</version>
        </dependency>
    </dependencies>

    <build>
        <plugins>
            <!-- tomcatæ’ä»¶ -->
            <plugin>
                <groupId>org.apache.tomcat.maven</groupId>
                <artifactId>tomcat7-maven-plugin</artifactId>
                <version>2.2</version>
                <configuration>
                    <port>8080</port>
                    <path>/blog</path>
                    <uriEncoding>UTF-8</uriEncoding>
                </configuration>
            </plugin>
        </plugins>
    </build>
</project>
```

#### 3.5 Web.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee
         http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"
         version="4.0">

     <!--è¯»å–Springé…ç½®æ–‡ä»¶:applicationContext.xml:ç”ŸæˆIOC-->
    <context-param>
        <param-name>contextConfigLocation</param-name>
        <param-value>classpath:spring/applicationContext.xml</param-value>
    </context-param>
    
    <!--é…ç½®ç›‘å¬å™¨ç›‘å¬IOCå®¹å™¨æ˜¯å¦æ­£å¸¸å·¥ä½œ-->
    <listener>
        <listener-class>org.springframework.web.context.ContextLoaderListener</listener-class>
    </listener>
    
    <!--SpringMVCçš„åˆ†å‘å™¨:DispatcherServlet-->
    <servlet>
        <servlet-name>springMVC</servlet-name>
        <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>

        <!--å› ä¸ºæœåŠ¡å™¨å¯åŠ¨çš„æ—¶å€™ä¼šç¬¬ä¸€æ—¶é—´è¯»å–web.xmlæ–‡ä»¶ï¼Œåœ¨æœåŠ¡å™¨å¯åŠ¨çš„
        çš„æ—¶å€™åŠ è½½springMVC.xml ServletConfig-->
        <init-param>
            <param-name>contextConfigLocation</param-name>
            <param-value>classpath:springMVC/springMVC.xml</param-value>
        </init-param>
        <!--åœ¨æœåŠ¡å™¨å¯åŠ¨çš„æ—¶å€™å°±åˆå§‹åŒ–è¯¥Servletå¯¹è±¡-->
        <load-on-startup>1</load-on-startup>
    </servlet>

    <servlet-mapping>
        <servlet-name>springMVC</servlet-name>
        <url-pattern>/</url-pattern>
    </servlet-mapping>
    
    <!--ç¼–ç è¿‡æ»¤å™¨-->
    <filter>
        <filter-name>EncodingFilter</filter-name>
        <filter-class>org.springframework.web.filter.CharacterEncodingFilter</filter-class>
        <!--å¼ºåˆ¶ä½¿ç”¨è¯¥ç¼–ç -->
        <init-param>
            <param-name>forceEncoding</param-name>
            <param-value>true</param-value>
        </init-param>
        <init-param>
            <param-name>encoding</param-name>
            <param-value>utf-8</param-value>
        </init-param>
    </filter>

    <filter-mapping>
        <filter-name>EncodingFilter</filter-name>
        <url-pattern>/*</url-pattern>
    </filter-mapping>
</web-app>
```



## ä¸‰ã€ç”¨æˆ·æ¨¡å—

### 1ã€ç”¨æˆ·ç™»å½•

#### 1.1 å‡†å¤‡å·¥ä½œ

æ‰¾åˆ°èµ„æ–™ä¸‹åå°ç™»å½•çš„é™æ€èµ„æºæ–‡ä»¶ï¼Œå¯¼å…¥åˆ°é¡¹ç›®ä¸­ï¼Œå¹¶å°†å…¶ä¿®æ”¹æˆjspæ–‡ä»¶

![å›¾ç‰‡5](/images/buildpro101/å›¾ç‰‡5.png)

æ³¨æ„ï¼š

â€‹		ç™»å½•ç•Œé¢æˆ‘ä»¬å¯ä»¥æ”¾ç½®åœ¨webappç›®å½•ï¼Œç”¨æˆ·å¯ä»¥ç›´æ¥è®¿é—®ï¼Œå…¶ä»–åå°çš„é¡µé¢éœ€è¦æ”¾åˆ°WEB-INFç›®å½•ï¼Œç”¨æˆ·ä¸èƒ½ç›´æ¥è®¿é—®ï¼Œéœ€è¦é€šè¿‡åå°è·³è½¬æ‰è¡Œã€‚

![å›¾ç‰‡6](/images/buildpro101/å›¾ç‰‡6.png)

#### 1.2 å¤„ç†å‰ç«¯æ–‡ä»¶

æŠŠcssã€jså’Œå›¾ç‰‡æ‹·è´åˆ°webappç›®å½•ä¸‹ï¼Œå¦‚ä¸Šå›¾ï¼Œåœ¨index.jspå¼•å…¥å¦‚ä¸‹æ ·å¼å’Œjs

```jsp
<link rel="icon" href="/blog/images/favicon.ico" type="image/x-icon"/>
<link href="/blog/css/back/default.css" rel="stylesheet" type="text/css" />

<!--å¿…è¦æ ·å¼-->
<link href="/blog/css/back/styles.css" rel="stylesheet" type="text/css" />
<link href="/blog/css/back/demo.css" rel="stylesheet" type="text/css" />
<link href="/blog/css/back/loaders.css" rel="stylesheet" type="text/css" />
<script src="/blog/js/jquery/jquery-2.1.1.min.js"></script>
<script type="text/javascript" src="/blog/js/jquery/jquery-ui.min.js"></script>
<script type="text/javascript" src='/blog/js/jquery/stopExecutionOnTimeout.js?t=1'></script>
<script src="/blog/js/layer-3.5.1/layer.js" type="text/javascript"></script>
<script src="/blog/js/jquery/Particleground.js" type="text/javascript"></script>
<script src="/blog/js/jquery/jquery.mockjax.js" type="text/javascript"></script>
<script src="/blog/js/myJs/controlLogin.js" type="text/javascript"></script>

```

#### 1.3 åˆ›å»ºåå°æ¨¡å—çš„åŒ…ç»“æ„

![å›¾ç‰‡7](/images/buildpro101/å›¾ç‰‡7.png)

#### 1.4 ä»£ç ç¼–å†™

##### 1.4.1 LoginController

åœ¨controlleråŒ…ä¸‹åˆ›å»ºè·³è½¬åˆ°åå°ç™»å½•é¡µé¢çš„ LoginControllerï¼ˆä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡æµè§ˆå™¨è®¿é—®ï¼Œå› ä¸ºæ”¾ç½®åœ¨webappç›®å½•ï¼‰

![å›¾ç‰‡8](/images/buildpro101/å›¾ç‰‡8.png)

```java
@Controller
public class LoginController {

    //è·³è½¬åˆ°åå°ç™»å½•é¡µé¢
    @RequestMapping("/login")
    public String toLogin(){
        return "redirect:/login.jsp";
    }
}
```

![å›¾ç‰‡9](/images/buildpro101/å›¾ç‰‡9.png)

##### 1.4.2 ç™»å½•é¡µé¢å›¾ç‰‡éªŒè¯ç 

é¦–å…ˆï¼Œæˆ‘ä»¬æ‰¾åˆ°ç™»å½•é¡µé¢çš„ç™»å½• Html ä»£ç 

```html
<div class='login_fields__password'>
    <div class='icon'>
        <img alt="" src='/blog/images/key.png'>
    </div>
    <input name="code" placeholder='éªŒè¯ç ' maxlength="4"  class="ValidateNum" type='text' 
           name="ValidateNum" autocomplete="off">
    <div class='validation' style="opacity: 1; right: -5px;top: -3px;">
        <canvas style="position: relative;top: 5px;cursor: pointer" class="J_codeimg" 
                id="myCanvas" onclick="Code();">å¯¹ä¸èµ·ï¼Œæ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒcanvasï¼Œè¯·ä¸‹è½½æœ€æ–°ç‰ˆæµè§ˆå™¨!
        </canvas>
    </div>
</div>
```

è¿™ä¸ªå›¾ç‰‡éªŒè¯çš„ç”Ÿæˆä½¿ç”¨çš„æ˜¯html5çš„canvasçš„ç»˜å›¾æŠ€æœ¯å®ç°çš„ï¼Œè¿™ä¸ªæˆ‘ä»¬ä¸ç”¨å…³å¿ƒï¼Œæˆ‘ä»¬åªéœ€è¦å…³æ³¨å•æœºéªŒè¯ç åˆ·æ–°éªŒè¯ç çš„æ–¹æ³•

![å›¾ç‰‡10](/images/buildpro101/å›¾ç‰‡10.png)

è¿™ä¸ªjsçš„ä½ç½®å¦‚ä¸‹å›¾

![å›¾ç‰‡11](/images/buildpro101/å›¾ç‰‡11.png)

canvasç»˜åˆ¶å›¾ç‰‡éªŒè¯ç ï¼Œè¿™ä¸ªä»£ç åŒå­¦ä»¬å¯ä»¥ä¸ç”¨å…³å¿ƒï¼ŒçŸ¥é“æœ‰è¿™å›äº‹å°±è¡Œäº†

```js
function showCheck(a) {
    CodeVal = a;
    var c = document.getElementById("myCanvas");
    var ctx = c.getContext("2d");
    ctx.clearRect(0, 0, 1000, 1000);
    ctx.font = "80px 'Hiragino Sans GB'";
    ctx.fillStyle = "#E8DFE8";
    ctx.fillText(a, 0, 100);
}
```

å®šä¹‰å‘é€å¼‚æ­¥è¯·æ±‚éªŒè¯ç å‡½æ•°

```js
function Code() {
    //å‘é€å¼‚æ­¥è¯·æ±‚éªŒè¯ç 
    $.ajax({
        url : '/blog/code',
        type : 'get',
        dataType : 'json',
        success : function (data) {
            var AdminCode = data;
            showCheck(AdminCode);
        }
    })}
```

ç¼–å†™åå°æ¥æ”¶å›¾ç‰‡éªŒè¯è¯·æ±‚çš„Controller

![å›¾ç‰‡12](/images/buildpro101/å›¾ç‰‡12.png)

hutoolæä¾›äº†ç”ŸæˆéªŒè¯ç çš„å·¥å…·ç±»

```java
package com.bjpowernode.blog.base.controller;

import cn.hutool.captcha.CaptchaUtil;
import cn.hutool.captcha.ShearCaptcha;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

import javax.servlet.http.HttpSession;

@RestController
public class ValidateCodeServlet {

    @GetMapping("/code")
    public String code(HttpSession session){
        //å®šä¹‰å›¾å½¢éªŒè¯ç çš„é•¿ã€å®½ã€éªŒè¯ç å­—ç¬¦æ•°ã€å¹²æ‰°çº¿å®½åº¦
        ShearCaptcha captcha = CaptchaUtil.createShearCaptcha(140, 35, 4, 4);

        //æŠŠæ­£ç¡®çš„éªŒè¯ç ä¿å­˜åœ¨sessionä¸­
        String code = captcha.getCode();
        session.setAttribute("code",code);
        //è¿”å›éªŒè¯ç å­—ç¬¦ä¸²
        return code;
    }
}

```

layui é€šè¿‡ use æ–¹æ³•åŠ è½½æ¨¡å—ã€‚å½“ä½ çš„ JS éœ€è¦ç”¨åˆ° layui æ¨¡å—çš„æ—¶å€™ï¼Œä¸”é¿å…åˆ°å¤„å†™ layui.use() çš„éº»çƒ¦ï¼Œæˆ‘ä»¬ä½¿ç”¨useåŠ è½½ç”¨æˆ·ç™»å½•æ ¡éªŒ

```js
layui.use('layer', function () {
    //éç©ºéªŒè¯
    $('input[type="button"]').click(function () {
        var login = $('.username').val();
        var pwd = $('.passwordNumder').val();
        var code = $('.ValidateNum').val();
        if (login == '') {
            ErroAlert('è¯·è¾“å…¥æ‚¨çš„è´¦å·');
            return false;
        } else if (pwd == '') {
            ErroAlert('è¯·è¾“å…¥å¯†ç ');
            return false;
        } else if (code == '' || code.length != 4) {
            ErroAlert('è¾“å…¥éªŒè¯ç ');
            return false;
        } else {
            $('.login').addClass('test'); //å€¾æ–œç‰¹æ•ˆ
            setTimeout(function () {
                $('.login').addClass('testtwo'); //å¹³ç§»ç‰¹æ•ˆ
            }, 300);
            setTimeout(function () {
                $('.authent').show().animate({ right: -320 }, {
                    easing: 'easeOutQuint',
                    duration: 600,
                    queue: false
                });
                $('.authent').animate({ opacity: 1 }, {
                    duration: 200,
                    queue: false
                }).addClass('visible');
            }, 500);

            //å‘é€å¼‚æ­¥æ ¡éªŒ
            $.ajax({
                url : '/blog/user/login',
                type : 'get',
                data : {
                    'username' : $('.username').val(),
                    'password' : $('.passwordNumder').val(),
                    'code' : $('.ValidateNum').val()
                },
                dataType : 'json',
                success : function (data) {
                    setTimeout(function () {
                        $('.authent').show().animate({ right: 90 }, {
                            easing: 'easeOutQuint',
                            duration: 600,
                            queue: false
                        });
                        $('.authent').animate({ opacity: 0 }, {
                            duration: 200,
                            queue: false
                        }).addClass('visible');
                        $('.login').removeClass('testtwo'); //å¹³ç§»ç‰¹æ•ˆ
                        $('.authent').hide();
                    }, 2000);
                    if(!data.ok){
                        setTimeout(function () {
                            $('.login').removeClass('test');
                            ErroAlert(data.mess);
                            //ç™»å½•å¤±è´¥ï¼Œå†æ¬¡å‘é€éªŒè¯ç 
                            $.ajax({
                                url : '/blog/code',
                                type : 'get',
                                dataType : 'json',
                                success : function (data) {
                                    var AdminCode = data;
                                    showCheck(AdminCode);
                                }
                            })
                        }, 2400);
                    }else{
                        setTimeout(function () {
                            $('.login').fadeOut(100)
                            //ç™»å½•æ ¡éªŒæˆåŠŸï¼Œè·³è½¬åˆ°åå°é¦–é¡µ
                            window.location.href="/blog/toIndex";
                        }, 2400);

                    }
                }
            });
        }
        return false;
    })
})
```

ErroAlert å¼¹å‡ºæ¡†å‡½æ•°å®šä¹‰åœ¨å¦‚ä¸‹å›¾ä½ç½®

```js
function ErroAlert(e) {
    var index = layer.alert(e, { icon: 5, time: 2000, offset: 't', closeBtn: 0, title: 'é”™è¯¯ä¿¡æ¯', btn: [], anim: 2, shade: 0 });
    layer.style(index, {
        color: '#777'
    }); 
}
```

##### 1.4.3 ç™»å½•åŠŸèƒ½åå°ä»£ç 

å› ä¸ºç³»ç»Ÿä¸­ä¼šæœ‰å¾ˆå¤šçš„å¼‚æ­¥è¯·æ±‚ï¼Œè€Œè¿™äº›è¯·æ±‚å¯èƒ½æˆåŠŸï¼Œä¹Ÿå¯èƒ½å¤±è´¥ï¼Œéœ€è¦ç»™ç”¨æˆ·ä¸€ä¸ªæ¶ˆæ¯æˆ–è€…ç»“æœé›†åé¦ˆï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨è‡ªå®šä¹‰å¼‚å¸¸ç”¨äºç»™å®¢æˆ·ç«¯è¿”å›æ“ä½œå¤±è´¥æ¶ˆæ¯ï¼Œè‡ªå®šä¹‰å®ä½“ç±»è¿”å›æ™®é€šæ¶ˆæ¯å’ŒæˆåŠŸæ¶ˆæ¯ï¼Œä½¿ç”¨æšä¸¾å®šä¹‰å¼‚å¸¸çš„ç±»å‹ã€‚

è‡ªå®šä¹‰å¼‚å¸¸ç±»å‹æšä¸¾ç±»

```java
public enum  BlogExceptionEnum{

    LOGIN_USER_PASS("001-001"),//ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯
    LOGIN_STATE("001-002"),//è´¦æˆ·è¢«é”å®š
    LOGIN_CODE("001-003"),//éªŒè¯ç è¾“å…¥é”™è¯¯
    USER_UPDATE("001-004"),//ç”¨æˆ·ä¿¡æ¯æ›´æ–°å¤±è´¥

    ARTICLE_ADD("002-001"),//æ·»åŠ æ–‡ç« å¤±è´¥
    ARTICLE_ISOPEN("002-002"),//ä¿®æ”¹çŠ¶æ€å¤±è´¥
    ARTICLE_UPDATE("002-003"),//ä¿®æ”¹æ–‡ç« å¤±è´¥
    ARTICLE_DELETE("002-004"),//åˆ é™¤æ–‡ç« å¤±è´¥
    ARTICLE_THUMBSUP("002-005");//æ›´æ–°ç‚¹èµæ•°å¤±è´¥

    private String type;

    BlogExceptionEnum(String type) {
        this.type = type;
    }

    public String getType() {
        return type;
    }

    public void setType(String type) {
        this.type = type;
    }
}
```

å¼‚å¸¸ç±»

```java
@Data
@ToString
public class BlogException extends RuntimeException {

    private BlogExceptionEnum blogExceptionEnum;

    public BlogException(BlogExceptionEnum blogExceptionEnum){
        super();
        this.blogExceptionEnum = blogExceptionEnum;
    }
}
```

è¿”å›æ¶ˆæ¯å’Œç»“æœé›†çš„è‡ªå®šä¹‰å®ä½“ç±»

```java
@Data
@ToString
public class ResultVo<T> {

    private boolean isOk;//æ˜¯å¦æˆåŠŸ
    private String mess;//è¿”å›ç»™å®¢æˆ·ç«¯çš„å…·ä½“æ¶ˆæ¯
    private List<T> data;//ç»™å®¢æˆ·ç«¯è¿”å›çš„æ•°æ®
    private T t;//è¿”å›å•ä¸ªå¯¹è±¡
}
```

ç”¨æˆ·å®ä½“ç±»

```java
@Data
@ToString
@Table(name = "t_user")
@NameStyle(Style.normal)
public class User {

    @Id
    private String uid;
    private String username;
    private String nickname;
    private String password;
    private String role;
    private String createTime;
    private String lastLoginTime;
    private String state;
    private String loginIp;
    private String phone;
    private String loginCout;
    private String img;
}
```

ç”¨æˆ·ç™»å½• UserController ç™»å½•æ–¹æ³•

```java
/**
* ç™»å½•åŠŸèƒ½
*/
@RequestMapping("/user/login")
@ResponseBody
public ResultVo login(User user, String code, HttpSession session, HttpServletRequest request){
    ResultVo resultVo = new ResultVo();
    try {
        //è·å–æ­£ç¡®çš„éªŒè¯ç 
        String correctCode = (String) session.getAttribute("code");
        //ç™»å½•IP
        user.setLoginIp(request.getRemoteAddr());
        user = userService.login(user,code,correctCode);
        //æŠŠç”¨æˆ·ä¿¡æ¯ä¿å­˜åœ¨sessionä¸­
        session.setAttribute(BlogConstants.LOGIN_USER,user);
        resultVo.setOk(true);
        resultVo.setMess("ç™»å½•æˆåŠŸ");
    } catch (BlogException e) {
        resultVo.setOk(false);
        if(e.getBlogExceptionEnum().getType().equals("001-001")){
            //ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯
            resultVo.setMess("ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯");
        }else if(e.getBlogExceptionEnum().getType().equals("001-002")){
            //è´¦å·è¢«é”å®š
            resultVo.setMess("è´¦å·è¢«é”å®šï¼Œè¯·è”ç³»ç®¡ç†å‘˜");
        }else if(e.getBlogExceptionEnum().getType().equals("001-003")){
            //è´¦å·è¢«é”å®š
            resultVo.setMess("éªŒè¯ç é”™è¯¯");
        }
    }
    return resultVo;
}
```

ç”¨æˆ·ç™»å½•service

```java
@Service
public class UserServiceImpl implements UserService {

    @Autowired
    private UserMapper userMapper;

    //ç”¨æˆ·åå°ç™»å½•åŠŸèƒ½
    @Override
    public User login(User user,String code,String correctCode) {
        String IP = user.getLoginIp();
        user.setLoginIp(null);
        //åŠ å¯†å¯†ç 
        String password = SecureUtil.md5(user.getPassword());
        user.setPassword(password);

        List<User> users = userMapper.select(user);
        //å…ˆåˆ¤æ–­è¾“å…¥çš„éªŒè¯ç æ­£ç¡®ä¸å¦
        if(!correctCode.equals(code)){
            throw new BlogException(BlogExceptionEnum.LOGIN_CODE);
        }else{
            if(users.size() == 0){
                throw new BlogException(BlogExceptionEnum.LOGIN_USER_PASS);
            }else{
                //ç”¨æˆ·è´¦å·æ˜¯å¦è¢«é”å®š
                user = users.get(0);
                if("0".equals(user.getState())){
                    throw new BlogException(BlogExceptionEnum.LOGIN_STATE);
                }else{
                    //æ›´æ–°ç”¨æˆ·ç™»å½•æ—¶é—´å’Œç™»å½•æ¬¡æ•°å’Œç™»å½•IP
                    user.setLoginCout(Integer.parseInt(user.getLoginCout()) + 1 + "");
                    user.setLastLoginTime(DateTimeUtil.getSysTime());
                    user.setLoginIp(IP);
                    userMapper.updateByPrimaryKeySelective(user);
                }
            }
        }
        return user;
    }
}
```

ç”¨æˆ·ç™»å½•æŒä¹…å±‚

```java
public interface UserMapper extends Mapper<User> {
}
```

### 2ã€ç”¨æˆ·ç™»å‡º

#### 2.1 æˆ‘ä»¬ç»™é€€å‡ºæŒ‰é’®ï¼Œæ·»åŠ ç™»å‡ºäº‹ä»¶

![å›¾ç‰‡13](/images/buildpro101/å›¾ç‰‡13.png)

ä»£ç :

```jsp
<a href="javascript:void(0)" onclick="loginOut()">é€€å‡ºç™»å½•</a>

//é€€å‡ºç³»ç»Ÿ
function loginOut() {
    layer.alert('ç¡®å®šé€€å‡ºç³»ç»Ÿå—ï¼Ÿ', {
        time: 0 //ä¸è‡ªåŠ¨å…³é—­
        ,btn: ['ç¡®å®š', 'å–æ¶ˆ']
        ,yes: function(index){
            layer.close(index);
            location.href = "/blog/user/loginOut";
        }
    });
}
```

#### 2.2 åå°Controlleræ–¹æ³•ç¼–å†™

```java
//ç™»å‡ºåŠŸèƒ½
@RequestMapping("/user/loginOut")
public String loginOut(HttpSession session){
    //æ¸…é™¤sessionä¸­çš„ç”¨æˆ·
    session.removeAttribute("user");
    //é‡å®šå‘åˆ°ç™»å½•é¡µé¢
    return "redirect:/login.jsp";
}
```

### 3ã€ä¿®æ”¹ç”¨æˆ·ä¸ªäººä¿¡æ¯

#### 3.1 å¼‚æ­¥æŸ¥è¯¢ç”¨æˆ·è¾“å…¥çš„åŸå§‹å¯†ç æ˜¯å¦æ­£ç¡®

ç‚¹å‡»ä¿®æ”¹ä¸ªäººä¿¡æ¯ä¸‹æ‹‰èœå•ï¼Œå¼¹å‡ºæ¨¡æ€çª—å£

![å›¾ç‰‡14](/images/buildpro101/å›¾ç‰‡14.png)

![å›¾ç‰‡15](/images/buildpro101/å›¾ç‰‡15.png)

å‰å°js

```js
//å¼‚æ­¥æ ¡éªŒæ—§å¯†ç è¾“å…¥æ˜¯å¦æ­£ç¡®
$('#oldPwd').blur(function () {
    $.post("/blog/user/verifyOldPwd",{'oldPwd':$(this).val()},function (data) {
        if(!data.ok){
            layer.msg(data.mess, {offset:'t'});
        }
    },'json');
});
```

åå°Controller

```java
//å¼‚æ­¥æ ¡éªŒç”¨æˆ·è¾“å…¥çš„åŸå§‹å¯†ç æ˜¯å¦æ­£ç¡®
@RequestMapping("/user/verifyOldPwd")
@ResponseBody
public ResultVo verifyOldPwd(String oldPwd,HttpSession session){
    ResultVo resultVo = new ResultVo();
    try{
        //è·å–å½“å‰ç™»å½•ç”¨æˆ·
        User user = (User) session.getAttribute("user");
        userService.verifyOldPwd(oldPwd,user);
        resultVo.setOk(true);
    }catch (BlogException e){
        resultVo.setMess(e.getMessage());
    }
    return resultVo;
}
```

åå°Service

```java
public void verifyOldPwd(String oldPwd, User user) {
    oldPwd = MD5Util.getMD5(oldPwd);
    String password = user.getPassword();
    if(!password.equals(oldPwd)){
        throw new BlogException(BlogEnum.USER_VERIFY_PASS);
    }
}
```

#### 3.2 æ›´æ–°ç”¨æˆ·ä¿¡æ¯

åœ¨æ­¤ï¼Œå‰å°çš„jséç©ºæ ¡éªŒã€æ–°å¯†ç å’Œç¡®è®¤å¯†ç æ˜¯å¦ä¸€è‡´ä»£ç çœç•¥

å‰å°js

```js
//å¼‚æ­¥æ›´æ–°ç”¨æˆ·ä¿¡æ¯
function updateUser() {
    //è¡¨å•åºåˆ—åŒ– èƒ½å¤ŸæŠŠè¡¨å•çš„å†…å®¹æ‹¼æ¥æˆ key=å€¼&key=å€¼...,è¿”å›å€¼æ˜¯å­—ç¬¦ä¸²
    var form = $('#updateUserForm').serialize();
    $.post("/blog/user/updateUser",form,function (data) {
        if(data.ok){
            layer.alert(data.mess, {icon: 6});

            setTimeout(function () {
                //é‡æ–°ç™»å½•,è·³è½¬åˆ°ç™»å½•é¡µé¢
                //setTimeout:éš”å¤šé•¿æ—¶é—´æ‰§è¡ŒæŒ‡å®šä»£ç 
                location.href = "/blog/login.jsp";
            },1000);

        }
    },'json');
}
```

åå°Controller

```java
//å¼‚æ­¥ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯
@RequestMapping("/user/updateUser")
@ResponseBody
public ResultVo updateUser(User user){
    ResultVo resultVo = new ResultVo();
    try{
        userService.updateUser(user);
        resultVo.setOk(true);
        resultVo.setMess("ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯æˆåŠŸ");
    }catch (BlogException e){
        resultVo.setMess(e.getMessage());
    }
    return resultVo;
}
```

Serviceå±‚

```java
@Override
public void updateUser(User user) {
    //ç»™ç”¨æˆ·è¾“å…¥çš„æ–°å¯†ç åŠ å¯†
    user.setPassword(MD5Util.getMD5(user.getPassword()));

    //count:å½±å“è®°å½•æ•°
    int count = userMapper.updateByPrimaryKeySelective(user);
    if(count == 0){
        throw new BlogException(BlogEnum.USER_UPDATE);
    }
}
```

## å››ã€æ–‡ç« æ¨¡å—

#### 1ã€ç»Ÿä¸€è·³è½¬è§†å›¾Controller

å› ä¸ºé¡¹ç›®ä¸­æœ‰å¾ˆå¤šå…³äºç‚¹å‡»èœå•è·³è½¬è§†å›¾çš„è¯·æ±‚ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ¯ä¸ªè¯·æ±‚æˆ‘ä»¬éœ€è¦ç¼–å†™ä¸€ä¸ªæ–¹æ³•è·³è½¬åˆ°æŒ‡å®šè§†å›¾ï¼Œæ‰€ä»¥ä¸ºäº†ç®€åŒ–æ“ä½œï¼Œæˆ‘ä»¬ä½¿ç”¨SpringMVCçš„ RestFul é£æ ¼æ¥å¤„ç†è§†å›¾çš„ç»Ÿä¸€è·³è½¬ï¼Œä»£ç å¦‚ä¸‹

```java
@Controller
public class ViewController {

    //localhost:8080/blog/add?name=..&title=...
    //localhost:8080/blog/add/zhangsan/æ—…æ¸¸  workbench/article/index
    @RequestMapping("/toView/{firstView}/{secondView}/{thirdView}")
    public String toView(
            @PathVariable("firstView") String firstView,
            @PathVariable("secondView") String secondView ,
            @PathVariable("thirdView") String thirdView){

        //File.separator:\
        return firstView + File.separator + secondView + File.separator + thirdView;
    }
}
```

#### 2ã€æ–‡ç« åˆ—è¡¨å±•ç¤º

ç°åœ¨æˆ‘ä»¬å®ç°æ–‡ç« æ•°æ®çš„åˆ†é¡µï¼Œæœ¬é¡¹ç›®ä¸­åŸºæœ¬éƒ½ä½¿ç”¨å¼‚æ­¥è¯·æ±‚çš„æ–¹å¼ï¼Œæ‰€ä»¥ç‚¹å‡»æ–‡ç« èœå•è·³è½¬åˆ°æ–‡ç« é¦–é¡µåå‘é€å¼‚æ­¥è¯·æ±‚ï¼ŒæŸ¥è¯¢æ–‡ç« åˆ—è¡¨æ•°æ®

å‰å°js

```js
$.post("/blog/article/list",{
    'page' : page,
    'pageSize' : pageSize,
    'title' : $('#title').val()
},function (data) {
    //è®¾ç½®å½“å‰æ–‡ç« æ•°é‡
    $('#count').text(data.total + "ç¯‡æ–‡ç« ");
    //æ¸…ç©ºåŸæ¥çš„å†…å®¹
    $('#articleBody').html("");
    //List<Article>
    var articles = data.list;
    for(var i =0 ; i < articles.length; i++){
        var article = articles[i];
        if(article.isOpen == "0"){
            $('#articleBody').append("<tr>\n" +
                "                <td><input type=\"checkbox\" class=\"input-control\" name=\"checkbox\" value=\"\" /></td>\n" +
                "                <td class=\"article-title\">"+article.title+"</td>\n" +
                "                <td>"+article.cid+"</td>\n" +
                "                <td class=\"hidden-sm\">"+article.tagNames+"</td>\n" +
                "                <td class=\"hidden-sm\">"+article.thumbsUp+"</td>\n" +
                "                <td>"+article.create_time+"</td>\n" +
                "                <td>\n" +
                "                    <a href=\"update-article.html\">ä¿®æ”¹</a> <a rel=\"6\">åˆ é™¤</a>&nbsp;\n" +
                "                    <input type=\"radio\" onclick=change(\'"+article.aid+"\',$(this).val()) name="+article.aid+" value=\"1\"/>å…¬å¼€ <input onclick=change(\'"+article.aid+"\',$(this).val()) type=\"radio\" checked name="+article.aid+" value=\"0\" />ç§å¯†\n" +
                "                </td>\n" +
                "              </tr>");
        }else{
            $('#articleBody').append("<tr>\n" +
                "                <td><input type=\"checkbox\" class=\"input-control\" name=\"checkbox\" value=\"\" /></td>\n" +
                "                <td class=\"article-title\">"+article.title+"</td>\n" +
                "                <td>"+article.cid+"</td>\n" +
                "                <td class=\"hidden-sm\">"+article.tagNames+"</td>\n" +
                "                <td class=\"hidden-sm\">"+article.thumbsUp+"</td>\n" +
                "                <td>"+article.create_time+"</td>\n" +
                "                <td>\n" +
                "                    <a href=\"update-article.html\">ä¿®æ”¹</a> <a rel=\"6\">åˆ é™¤</a>&nbsp;\n" +
                "                    <input onclick=change(\'"+article.aid+"\',$(this).val()) type=\"radio\" name="+article.aid+" value=\"1\" checked/>å…¬å¼€ <input onclick= change(\'"+article.aid+"\',$(this).val()) type=\"radio\" name="+article.aid+" value=\"0\" />ç§å¯†\n" +
                "                </td>\n" +
                "              </tr>");
        }
    }
    });
},'json');
```

åå°Controller

```java
@RequestMapping("/article/list")
@ResponseBody
public List<Article> list(int page,int pageSize){
    //å‚æ•°1:å½“å‰é¡µç  å‚æ•°2:æ¯é¡µè®°å½•æ•° pageSize è¯¥æ–¹æ³•ç­‰åŒäº limit a,b
    PageHelper.startPage(page,pageSize);
    List<Article> articles = articleService.list();
    PageInfo<Article> pageInfo = new PageInfo<>(articles);
    return pageInfo.getList();
}
```

Serviceä»£ç 

```java
@Override
public List<Article> list(String title) {
    List<Article> articles = articleMapper.selectAll();
    //éå†æ‰€æœ‰æ–‡ç« 
    for (Article article : articles) {
        String cid = article.getCid();
        //æ ¹æ®cidæŸ¥è¯¢æ ç›®è¡¨ï¼ŒæŸ¥è¯¢æ ç›®å¯¹è±¡
        Category category = categoryMapper.selectByPrimaryKey(cid);
        article.setCid(category.getCname());
    }
    return articles;
}
```

#### 3ã€æ–‡ç« åˆ—è¡¨åˆ†é¡µ

æ­¤å¤„çš„åˆ†é¡µï¼Œæˆ‘ä»¬ä½¿ç”¨BootStrapçš„åˆ†é¡µæ’ä»¶

![å›¾ç‰‡16](/images/buildpro101/å›¾ç‰‡16.png)

åœ¨é¡¹ç›®ä¸­å¼•å…¥åˆ†é¡µæ’ä»¶

![å›¾ç‰‡17](/images/buildpro101/å›¾ç‰‡17.png)

åˆ†é¡µæ’ä»¶çš„æ¨¡æ¿ä»£ç 

```js
//bootstrapçš„åˆ†é¡µæ’ä»¶
$("#activityPage").bs_pagination({
    currentPage: data.pageNum, // é¡µç 
    rowsPerPage: data.pageSize, // æ¯é¡µæ˜¾ç¤ºçš„è®°å½•æ¡æ•°
    maxRowsPerPage: 20, // æ¯é¡µæœ€å¤šæ˜¾ç¤ºçš„è®°å½•æ¡æ•°
    totalPages: data.pages, // æ€»é¡µæ•°
    totalRows: data.total, // æ€»è®°å½•æ¡æ•°
    visiblePageLinks: 3, // æ˜¾ç¤ºå‡ ä¸ªå¡ç‰‡
    showGoToPage: true,
    showRowsPerPage: true,
    showRowsInfo: true,
    showRowsDefaultInfo: true,
    //å›è°ƒå‡½æ•°ï¼Œç”¨æˆ·æ¯æ¬¡ç‚¹å‡»åˆ†é¡µæ’ä»¶è¿›è¡Œç¿»é¡µçš„æ—¶å€™å°±ä¼šè§¦å‘è¯¥å‡½æ•°
    onChangePage : function(event, obj){
        //currentPage:å½“å‰é¡µç  rowsPerPage:æ¯é¡µè®°å½•æ•°
        refresh(obj.currentPage,obj.rowsPerPage);
    }
});
```

æ¯æ¬¡æ“ä½œåˆ†é¡µæ’ä»¶ç»„å»ºçš„æ—¶å€™éƒ½ä¼šå‡ºå‘å…¶ä¸­çš„onCHangePageå‡½æ•°ï¼Œå†…ç½®å‚æ•°objä¸­åŒ…å«äº†å½“å‰é¡µç å’Œæ¯é¡µè®°å½•æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠå‰ç«¯åˆ—è¡¨æŸ¥è¯¢åˆ†è£…æˆä¸€ä¸ªåˆ·æ–°é¡µé¢çš„å‡½æ•°

å‰ç«¯jsä»£ç å¦‚ä¸‹

```js
//è°ƒç”¨åˆ·æ–°æ–¹æ³•
refresh(1,2);

//å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œå‘é€è¯·æ±‚ä¸åŒé¡µç å¯¹åº”çš„æ•°æ®
function refresh(page,pageSize){
    //å‘é€æŸ¥è¯¢æ‰€æœ‰æ–‡ç« åˆ—è¡¨çš„å¼‚æ­¥è¯·æ±‚
    $.post("/blog/article/list",{
        'page' : page,
        'pageSize' : pageSize,
    },function (data) {
        //è®¾ç½®å½“å‰æ–‡ç« æ•°é‡
        $('#count').text(data.total + "ç¯‡æ–‡ç« ");
        //æ¸…ç©ºåŸæ¥çš„å†…å®¹
        $('#articleBody').html("");
        //List<Article>
        var articles = data.list;
        for(var i =0 ; i < articles.length; i++){
            var article = articles[i];
            if(article.isOpen == "0"){
                $('#articleBody').append("<tr>\n" +
                    "                <td><input type=\"checkbox\" class=\"input-control\" name=\"checkbox\" value=\"\" /></td>\n" +
                    "                <td class=\"article-title\">"+article.title+"</td>\n" +
                    "                <td>"+article.cid+"</td>\n" +
                    "                <td class=\"hidden-sm\">"+article.tagNames+"</td>\n" +
                    "                <td class=\"hidden-sm\">"+article.thumbsUp+"</td>\n" +
                    "                <td>"+article.create_time+"</td>\n" +
                    "                <td>\n" +
                    "                    <a href=\"update-article.html\">ä¿®æ”¹</a> <a rel=\"6\">åˆ é™¤</a>&nbsp;\n" +
                    "                    <input type=\"radio\" onclick=change(\'"+article.aid+"\',$(this).val()) name="+article.aid+" value=\"1\"/>å…¬å¼€ <input onclick=change(\'"+article.aid+"\',$(this).val()) type=\"radio\" checked name="+article.aid+" value=\"0\" />ç§å¯†\n" +
                    "                </td>\n" +
                    "              </tr>");
            }else{
                $('#articleBody').append("<tr>\n" +
                    "                <td><input type=\"checkbox\" class=\"input-control\" name=\"checkbox\" value=\"\" /></td>\n" +
                    "                <td class=\"article-title\">"+article.title+"</td>\n" +
                    "                <td>"+article.cid+"</td>\n" +
                    "                <td class=\"hidden-sm\">"+article.tagNames+"</td>\n" +
                    "                <td class=\"hidden-sm\">"+article.thumbsUp+"</td>\n" +
                    "                <td>"+article.create_time+"</td>\n" +
                    "                <td>\n" +
                    "                    <a href=\"update-article.html\">ä¿®æ”¹</a> <a rel=\"6\">åˆ é™¤</a>&nbsp;\n" +
                    "                    <input onclick=change(\'"+article.aid+"\',$(this).val()) type=\"radio\" name="+article.aid+" value=\"1\" checked/>å…¬å¼€ <input onclick= change(\'"+article.aid+"\',$(this).val()) type=\"radio\" name="+article.aid+" value=\"0\" />ç§å¯†\n" +
                    "                </td>\n" +
                    "              </tr>");
            }
        }

        //bootstrapçš„åˆ†é¡µæ’ä»¶
        $("#activityPage").bs_pagination({
            currentPage: data.pageNum, // é¡µç 
            rowsPerPage: data.pageSize, // æ¯é¡µæ˜¾ç¤ºçš„è®°å½•æ¡æ•°
            maxRowsPerPage: 20, // æ¯é¡µæœ€å¤šæ˜¾ç¤ºçš„è®°å½•æ¡æ•°
            totalPages: data.pages, // æ€»é¡µæ•°
            totalRows: data.total, // æ€»è®°å½•æ¡æ•°
            visiblePageLinks: 3, // æ˜¾ç¤ºå‡ ä¸ªå¡ç‰‡
            showGoToPage: true,
            showRowsPerPage: true,
            showRowsInfo: true,
            showRowsDefaultInfo: true,
            //å›è°ƒå‡½æ•°ï¼Œç”¨æˆ·æ¯æ¬¡ç‚¹å‡»åˆ†é¡µæ’ä»¶è¿›è¡Œç¿»é¡µçš„æ—¶å€™å°±ä¼šè§¦å‘è¯¥å‡½æ•°
            onChangePage : function(event, obj){
                //currentPage:å½“å‰é¡µç  rowsPerPage:æ¯é¡µè®°å½•æ•°
                refresh(obj.currentPage,obj.rowsPerPage);
            }
        });
    },'json');
}
```

åå°Controllerä¿®æ”¹ä¸º

```java
@RequestMapping("/article/list")
@ResponseBody
public PageInfo<Article> list(int page,int pageSize){
    //å‚æ•°1:å½“å‰é¡µç  å‚æ•°2:æ¯é¡µè®°å½•æ•° pageSize è¯¥æ–¹æ³•ç­‰åŒäº limit a,b
    PageHelper.startPage(page,pageSize);
    List<Article> articles = articleService.list();
    PageInfo<Article> pageInfo = new PageInfo<>(articles);
    return pageInfo;
}
```

#### 4ã€æ–‡ç« çš„æ¨¡ç³ŠæŸ¥è¯¢

æ–‡ç« æ¨¡å—æ”¯æŒæŒ‰æ–‡ç« æ ‡é¢˜æ¨¡ç³ŠæŸ¥è¯¢ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨refreshæ–¹æ³•ä¸­æ·»åŠ æŒ‡å®šå‚æ•°å³å¯

![å›¾ç‰‡18](/images/buildpro101/å›¾ç‰‡18.png)

åå°Controllerä»£ç æ”¹ä¸º

```java
@RequestMapping("/article/list")
@ResponseBody
public PageInfo<Article> list(int page,int pageSize,String title){
    //å‚æ•°1:å½“å‰é¡µç  å‚æ•°2:æ¯é¡µè®°å½•æ•° pageSize è¯¥æ–¹æ³•ç­‰åŒäº limit a,b
    PageHelper.startPage(page,pageSize);
    List<Article> articles = articleService.list(title);
    PageInfo<Article> pageInfo = new PageInfo<>(articles);
    return pageInfo;
}
```

#### 5ã€ä¿®æ”¹æ–‡ç« æ˜¯å¦å…¬å¼€

æˆ‘ä»¬ç»™æ¯æ¡æ–‡ç« æ˜¯å¦å…¬å¼€çš„å•é€‰æ¡†æ·»åŠ äº‹ä»¶ï¼Œå‚æ•°ä¸ºå½“å‰æ–‡ç« çš„idå·å’Œå•é€‰æ¡†çš„valueå€¼å³å¯ï¼Œç¼–å†™å‡½æ•°ï¼Œå‘é€å¼‚æ­¥ä¿®æ”¹æ–‡ç« æ˜¯å¦å…¬å¼€çŠ¶æ€

![å›¾ç‰‡19](/images/buildpro101/å›¾ç‰‡19.png)

changeå‡½æ•°

```js
//å®šä¹‰æ”¹å˜æ˜¯å¦å…¬å¼€å‡½æ•°
function change(aid,value) {
   $.get("/blog/article/isOpen",{
       'aid' : aid,
       'isOpen' : value
   },function (data) {
       layer.alert(data.mess, {icon:6});
   },'json');
}
```

åå°Controller

```java
//å¼‚æ­¥ä¿®æ”¹æ–‡ç« æ˜¯å¦å…¬å¼€
@RequestMapping("/article/isOpen")
@ResponseBody
public ResultVo isOpen(Article article){
    ResultVo resultVo = new ResultVo();
    try {
        articleService.isOpen(article);
        resultVo.setOk(true);
        if(article.getIsOpen().equals("0")){
            resultVo.setMess("æ–‡ç« å·²ç§å¯†");
        }else{
            resultVo.setMess("æ–‡ç« å·²å…¬å¼€");
        }
    }catch (BlogException e){
        resultVo.setMess(e.getMessage());
    }
    return resultVo;
}
```

Servicä»£ç 

```java
@Override
public void isOpen(Article article) {
    int count = articleMapper.updateByPrimaryKeySelective(article);
    if(count == 0){
        throw new BlogException(BlogEnum.USER_LOGIN_CODE);
    }
}
```

#### 6ã€æ–‡ç« çš„æ·»åŠ 

##### 6.1 Editormdä»‹ç»å’Œä¸Šä¼ å›¾ç‰‡

Editormdä»‹ç»

Editormdæ”¯æŒâ€œæ ‡å‡†â€ Markdown / CommonMark å’Œ Github é£æ ¼çš„è¯­æ³•ï¼Œä¹Ÿå¯å˜èº«ä¸ºä»£ç ç¼–è¾‘å™¨ï¼Œæ”¯æŒå®æ—¶é¢„è§ˆã€å›¾ç‰‡ï¼ˆè·¨åŸŸï¼‰ä¸Šä¼ ã€é¢„æ ¼å¼æ–‡æœ¬/ä»£ç /è¡¨æ ¼æ’å…¥ã€ä»£ç æŠ˜å ã€æœç´¢æ›¿æ¢ã€åªè¯»æ¨¡å¼ã€è‡ªå®šä¹‰æ ·å¼ä¸»é¢˜å’Œå¤šè¯­è¨€è¯­æ³•é«˜äº®ç­‰åŠŸèƒ½

![å›¾ç‰‡20](/images/buildpro101/å›¾ç‰‡20.png)

ä¸Šä¼ å›¾ç‰‡

 åœ¨é¡¹ç›®ä¸­å¯¼å…¥Editormdæ’ä»¶

![å›¾ç‰‡21](/images/buildpro101/å›¾ç‰‡21.png)

ç¼–å†™ä¸Šä¼ å›¾ç‰‡çš„æ¨¡æ¿jsä»£ç 

```js
var editor;
$(function() {
    editor = editormd("test-editor", {
        width  : "100%",
        height : "500px",
        path   : "/blog/editormd/lib/",//ç¬¬ä¸‰æ–¹ä¾èµ–åº“
        saveHTMLToTextarea : true,//è·å–ç”¨æˆ·ç¼–è¾‘çš„å†…å®¹ï¼Œå°†å…¶æ”¾å…¥åˆ°textareaä¸­
        emoji: true,//emojiè¡¨æƒ…ï¼Œé»˜è®¤å…³é—­
        syncScrolling : "single",
        /*ä¸Šä¼ æ–‡ä»¶é…ç½®*/
        imageUpload : true,//å¼€å¯ä¸Šä¼ æ–‡ä»¶åŠŸèƒ½
        imageFormats : ["jpg", "jpeg", "gif", "png", "bmp", "webp"],//ä¸Šä¼ å›¾ç‰‡æ ¼å¼
        imageUploadURL : "/blog/editorUpload",//åç«¯ä¸Šä¼ å›¾ç‰‡æœåŠ¡åœ°å€
    });
});
```

ç¼–å†™ä¸Šä¼ æ–‡ä»¶çš„Controller

```java
//è§£å†³Editormdæ–‡ä»¶ä¸Šä¼ 
@RequestMapping("/editorUpload")
@ResponseBody
public Map<String,Object> editorUpload(
        @RequestParam(value = "editormd-image-file", required = false)MultipartFile img,
        HttpSession session){
    Map<String, Object> map = FileUploadUtil.fileUpload(img, session);
    return map;
}
```

ç¼–å†™ç”¨äºä¸Šä¼ æ–‡ä»¶çš„å·¥å…·ç±» FileUploadUtil

```java
//ä¸Šä¼ mdçš„å›¾ç‰‡
public static Map<String,Object> fileUpload(@RequestParam(value = "editormd-image-file", required = false) MultipartFile img,
                                     HttpSession session){
    /*
    å‡†å¤‡æŠŠä¸Šä¼ å›¾ç‰‡ä¿å­˜åœ¨uploadç›®å½•ä¸‹ï¼Œè¿˜æœ‰å­ç›®å½• upload/æ—¶é—´/ç”¨æˆ·å/å¾ˆå¤šçš„å›¾ç‰‡
    */
    String realPath = session.getServletContext().getRealPath("/upload");
    realPath += File.separator + DateTimeUtil.getDate();
    //è·å–ç™»å½•ç”¨æˆ·
    User user = (User) session.getAttribute("user");
    realPath += File.separator + user.getUsername();

    File file = new File(realPath);
    if(!file.exists()){
        //åˆ›å»ºå¸¦å±‚çº§çš„ç›®å½• mkdir:åªèƒ½åˆ›å»ºä¸€çº§ç›®å½•
        file.mkdirs();
    }
    //ç›¸åŒç”¨æˆ·å¯èƒ½ä¼šä¸Šä¼ ç›¸åŒçš„æ–‡ä»¶åçš„å›¾ç‰‡ï¼Œé˜²æ­¢æ–‡ä»¶é‡å
    //è·å–ç”¨æˆ·å
    String fileName = img.getOriginalFilename();

    //1223434324æ–‡ä»¶å.png/jpg
    fileName = System.currentTimeMillis() + fileName;

    //å®šä¹‰ç”¨äºç»™Editormdè¿”å›çš„mapæ•°æ®
    Map<String,Object> map = new HashMap<>();
    //è·å–å›è°ƒåœ°å€
    String url = "http://localhost/blog/upload/" + DateTimeUtil.getDate()
            +File.separator + user.getUsername() + File.separator + fileName;
    try {
        img.transferTo(new File(realPath + File.separator + fileName));
        //è¿”å›success:1(æ•°å­—) url:å›¾ç‰‡å›è°ƒåœ°å€(å›¾ç‰‡åœ¨æœåŠ¡å™¨å­˜å‚¨è·¯å¾„)
        map.put("success",1);
        map.put("url",url);
    } catch (IOException e) {
        e.printStackTrace();
    }
    return map;
}
```

æ•ˆæœå¦‚ä¸‹å›¾

![å›¾ç‰‡22](/images/buildpro101/å›¾ç‰‡22.png)

##### 6.2 ä¸Šä¼ æ–‡ç« logo

æ·»åŠ å¼‚æ­¥ä¸Šä¼  js æ–‡ä»¶

![å›¾ç‰‡23](/images/buildpro101/å›¾ç‰‡23.png)

ç¼–å†™å¼‚æ­¥ä¸Šä¼ js

```js
//ä¸Šä¼ æ–‡ç« logo
//å¼‚æ­¥ä¸Šä¼ æ–‡ä»¶
$('#img').change(function () {
    $.ajaxFileUpload({
            url: '/blog/fileUpload', //ç”¨äºæ–‡ä»¶ä¸Šä¼ çš„æœåŠ¡å™¨ç«¯è¯·æ±‚åœ°å€
            fileElementId: 'img', //æ–‡ä»¶ä¸Šä¼ åŸŸçš„ID
            dataType: 'json', //è¿”å›å€¼ç±»å‹ ä¸€èˆ¬è®¾ç½®ä¸ºjson
            success: function (data, status) {
                if(data.success == 1){
                    alert(data.message);
                }
            },
        }
    )
    return false;
});
```

åå°ä¸Šä¼ æ–‡ä»¶Controlleræ·»åŠ ä»£ç å¦‚ä¸‹

```java
//ä¸Šä¼ å›¾ç‰‡
@RequestMapping("/fileUpload")
@ResponseBody
public Map<String,Object> fileUpload(MultipartFile img, HttpSession session){
    Map<String, Object> map = FileUploadUtil.fileUpload(img, session);
    return map;
}
```

ä¸Šä¼ æ–‡ä»¶å·¥å…·ç±»è‘—éœ€è¦æ·»åŠ å¦‚ä¸‹ä»£ç å³å¯

![å›¾ç‰‡24](/images/buildpro101/å›¾ç‰‡24.png)

##### 6.3 å¼‚æ­¥åŠ è½½æ‰€æœ‰æ ç›®

å‘é€æŸ¥è¯¢æ‰€æœ‰æ ç›®è¯·æ±‚ï¼Œæ‹¼æ¥é¡µé¢å†…å®¹ï¼Œå¦‚ä¸‹å›¾

![å›¾ç‰‡25](/images/buildpro101/å›¾ç‰‡25.png)

å‰å°js

```js
//å¼‚æ­¥æŸ¥è¯¢æ‰€æœ‰æ ç›®ï¼ŒæŠŠè¿”å›çš„jsonä¸²æ‹¼æ¥åˆ°ä¸‹æ‹‰æ¡†ä¸­
$.get("/blog/article/queryCategory",function (data) {
    //List<Category>
    for(var i = 0; i < data.length; i++){
        $('#categories').append("<option value="+data[i].cid+">"+data[i].cname+"</option>");
    }
},'json');
```

åå°Controller

```java
//å¼‚æ­¥æŸ¥è¯¢æ‰€æœ‰æ ç›®
@RequestMapping("/article/queryCategory")
@ResponseBody
public List<Category> queryCategory(){
    List<Category> categories = articleService.queryCategory();
    return categories;
}
```

Serviceä»£ç 

```java
@Override
public List<Category> queryCategory() {
    return categoryMapper.selectAll();
}
```

##### 6.4 æŸ¥è¯¢æ ç›®å¯¹åº”çš„æ ‡ç­¾

é€‰ä¸­æ ç›®åå‘é€å¼‚æ­¥è¯·æ±‚ï¼ŒæŸ¥è¯¢æŒ‡å®šæ ç›®ä¸‹çš„æ‰€æœ‰æ ‡ç­¾ï¼Œä¸‹è¿‡å¦‚ä¸‹å›¾

![å›¾ç‰‡26](/images/buildpro101/å›¾ç‰‡26.png)

å‰å°js

```js
//é€‰ä¸­æ ç›®ï¼ŒåŠ è½½æ ç›®ä¸‹å¯¹åº”çš„æ ‡ç­¾
$('#categories').change(function () {
    $.get("/blog/article/queryTags",{'cid':$(this).val()},function (data) {
        //List<Tag>
        //æ¸…ç©ºå†…å®¹
        $('#tags').html("");
        for(var i = 0; i < data.length; i++){
            $('#tags').append("<input type='checkbox' />"+data[i].tname+"&nbsp;&nbsp;&nbsp;");
        }
    },'json');
});
```

åå°Controller

```java
@RequestMapping("/article/queryTags")
@ResponseBody
public List<Tag> queryTags(String cid){
    List<Tag> tags = articleService.queryTags(cid);
    return tags;
}
```

Serviceä»£ç 

```java
@Override
public List<Tag> queryTags(String cid) {
    Tag tag = new Tag();
    tag.setCid(cid);
    return tagMapper.select(tag);
}
```

